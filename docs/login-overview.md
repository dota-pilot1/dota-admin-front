# ğŸ—ï¸ ë¡œê·¸ì¸ ì‹œìŠ¤í…œ ê°œìš”

## ğŸ“– ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP Request     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚   Backend       â”‚
â”‚   (Next.js)     â”‚                     â”‚   (Spring Boot) â”‚
â”‚                 â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    HTTP Response    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                       â”‚
         â”‚                                       â”‚
         v                                       v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Local Storage â”‚                     â”‚   PostgreSQL    â”‚
â”‚   - JWT Token   â”‚                     â”‚   - Users       â”‚
â”‚   - User Info   â”‚                     â”‚   - Roles       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚   - RefreshTokensâ”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” ì¸ì¦ ë°©ì‹

| êµ¬ë¶„ | í† í° ì¢…ë¥˜ | ë§Œë£Œ ì‹œê°„ | ì €ì¥ ìœ„ì¹˜ | ìš©ë„ |
|------|-----------|-----------|-----------|------|
| Primary | JWT Access Token | 5ë¶„ | localStorage | API ìš”ì²­ ì¸ì¦ |
| Secondary | Refresh Token | 14ì¼ | HttpOnly Cookie | í† í° ê°±ì‹  |

## ğŸ¯ í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### í”„ë¡ íŠ¸ì—”ë“œ
- **AuthGuard**: í˜ì´ì§€ ì ‘ê·¼ ê¶Œí•œ í™•ì¸
- **Axios ì¸í„°ì…‰í„°**: ìë™ í† í° ì²¨ë¶€ ë° ê°±ì‹ 
- **useLogin Hook**: ë¡œê·¸ì¸ ì²˜ë¦¬ ë° ìƒíƒœ ê´€ë¦¬

### ë°±ì—”ë“œ
- **JwtAuthenticationFilter**: JWT í† í° ê²€ì¦
- **AuthController**: ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ/í† í°ê°±ì‹  API
- **RefreshTokenService**: Refresh Token ê´€ë¦¬

## âš¡ ì£¼ìš” ê¸°ëŠ¥

### 1. ìë™ í† í° ê°±ì‹ 
```typescript
// 401 ì—ëŸ¬ ê°ì§€ ì‹œ ìë™ ì²˜ë¦¬
if (errorCode === 'TOKEN_EXPIRED') {
  const newToken = await refreshToken();
  // ì›ë³¸ ìš”ì²­ ì¬ì‹œë„
}
```

### 2. Race Condition ë°©ì§€
```typescript
// ë¡œê·¸ì¸ ì„±ê³µ í›„ ì§€ì—° ë¦¬ë‹¤ì´ë ‰íŠ¸
setTimeout(() => {
  window.location.href = '/dashboard';
}, 500);
```

### 3. Token Rotation
```java
// ê¸°ì¡´ í† í° ë¬´íš¨í™” í›„ ìƒˆ í† í° ë°œê¸‰
refreshTokenService.invalidateToken(oldToken);
return generateNewTokens(user);
```

## ğŸ›¡ï¸ ë³´ì•ˆ íŠ¹ì§•

- **BCrypt í•´ì‹±**: ë¹„ë°€ë²ˆí˜¸ ì•ˆì „ ì €ì¥
- **JWT ì„œëª…**: HMAC SHA-256ìœ¼ë¡œ ìœ„ì¡° ë°©ì§€
- **HttpOnly Cookie**: XSS ê³µê²© ë°©ì§€
- **Token Rotation**: í† í° íƒˆì·¨ ì‹œ í”¼í•´ ìµœì†Œí™”

## ğŸ“‹ API ì—”ë“œí¬ì¸íŠ¸

| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… | ì¸ì¦ í•„ìš” |
|--------|------|------|-----------|
| POST | /api/auth/login | ë¡œê·¸ì¸ | âŒ |
| POST | /api/auth/refresh | í† í° ê°±ì‹  | ğŸª Cookie |
| POST | /api/auth/logout | ë¡œê·¸ì•„ì›ƒ | âœ… JWT |
| GET | /api/user/me | ë‚´ ì •ë³´ ì¡°íšŒ | âœ… JWT |

## ğŸ”„ í† í° ìƒëª…ì£¼ê¸°

```
1. ë¡œê·¸ì¸ ì„±ê³µ
   â†“
2. JWT (5ë¶„) + Refresh Token (14ì¼) ë°œê¸‰
   â†“
3. API ìš”ì²­ ì‹œ JWT ìë™ ì²¨ë¶€
   â†“
4. JWT ë§Œë£Œ ì‹œ Refresh Tokenìœ¼ë¡œ ìë™ ê°±ì‹ 
   â†“
5. ìƒˆ JWT + ìƒˆ Refresh Token ë°œê¸‰ (Token Rotation)
   â†“
6. Refresh Token ë§Œë£Œ ì‹œ ì¬ë¡œê·¸ì¸ í•„ìš”
```

## âš™ï¸ í™˜ê²½ ì„¤ì •

### ë°±ì—”ë“œ (application.yml)
```yaml
app:
  jwt:
    secret: ${JWT_SECRET:your-secret-key}
    expiration: 300000  # 5ë¶„ (ë°€ë¦¬ì´ˆ)
  refresh-token:
    expiration: 1209600000  # 14ì¼ (ë°€ë¦¬ì´ˆ)
```

### í”„ë¡ íŠ¸ì—”ë“œ (í™˜ê²½ë³€ìˆ˜)
```env
NEXT_PUBLIC_API_BASE_URL=http://localhost:8080
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê³„ì •

| ì´ë©”ì¼ | ë¹„ë°€ë²ˆí˜¸ | ì—­í•  |
|--------|----------|------|
| terecal@daum.net | 123456 | ADMIN |
| test@example.com | password123 | USER |

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- [ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤ ê°€ì´ë“œ](./login-process.md) - ìƒì„¸í•œ ë‹¨ê³„ë³„ í”„ë¡œì„¸ìŠ¤
- [API ë¬¸ì„œ] - ë°±ì—”ë“œ API ìƒì„¸ ëª…ì„¸
