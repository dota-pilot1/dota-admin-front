# ðŸ—ï¸ ë¡œê·¸ì¸ ì‹œìŠ¤í…œ ê°œìš”

## ðŸ“– ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡° (ìµœì‹ í™”)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP Request     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚   Backend       â”‚
â”‚   (Next.js)     â”‚                     â”‚   (Spring Boot) â”‚
â”‚                 â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    HTTP Response    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                       â”‚
         v                                       v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Local Storage â”‚                     â”‚   PostgreSQL                â”‚
â”‚   - JWT Token   â”‚                     â”‚   - Users                   â”‚
â”‚   - User Info   â”‚                     â”‚   - Roles                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚   - RefreshTokens (DB ê´€ë¦¬)  â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ” ì¸ì¦ ë°©ì‹ ë° í† í° ê´€ë¦¬

| êµ¬ë¶„      | í† í° ì¢…ë¥˜         | ë§Œë£Œ ì‹œê°„ | ì €ìž¥ ìœ„ì¹˜      | ìš©ë„         |
|-----------|------------------|-----------|---------------|--------------|
| Primary   | JWT Access Token | 5ë¶„       | localStorage  | API ì¸ì¦     |
| Secondary | Refresh Token    | 14ì¼      | DB(PostgreSQL)| ìž¬ë°œê¸‰/ì„¸ì…˜ê´€ë¦¬ |

- Access Token: stateless, ë¹ ë¥¸ ì¸ì¦
- Refresh Token: DBì—ì„œ ê´€ë¦¬, ì„¸ì…˜/ë³´ì•ˆ/ê°•ì œ ë¡œê·¸ì•„ì›ƒ ë“± ì œì–´ ê°€ëŠ¥

---

## âš¡ DB ê¸°ë°˜ í† í° ê´€ë¦¬ í™œìš© ë°©ì‹

- **ê°•ì œ ë¡œê·¸ì•„ì›ƒ**: ê´€ë¦¬ìžê°€ íšŒì› ê´€ë¦¬ íŽ˜ì´ì§€ì—ì„œ íŠ¹ì • ì‚¬ìš©ìžì˜ í† í°ì„ DBì—ì„œ ì‚­ì œ/ì°¨ë‹¨ â†’ ì¦‰ì‹œ ë¡œê·¸ì•„ì›ƒ
- **ë¸”ëž™ë¦¬ìŠ¤íŠ¸/ì„¸ì…˜ ê´€ë¦¬**: ì—¬ëŸ¬ ê¸°ê¸°/ë¸Œë¼ìš°ì €ë³„ ì„¸ì…˜ ê´€ë¦¬, í† í° ì´ë ¥ ì¶”ì 
- **ë³´ì•ˆ/ìš´ì˜**: ì‹¤ì‹œê°„ ì„¸ì…˜ ì œì–´, ê°ì‚¬/ì¶”ì  ê°€ëŠ¥

### ì£¼ìš” êµ¬í˜„ ì˜ˆì‹œ
```java
// í† í° ê²€ì¦
public boolean isTokenValid(String token) {
    RefreshTokenEntity entity = refreshTokenRepository.findByRefreshToken(token);
    return entity != null && !entity.isRevoked() && entity.getExpiresAt().isAfter(LocalDateTime.now());
}

// ê°•ì œ ë¡œê·¸ì•„ì›ƒ
public void revokeToken(String token) {
    RefreshTokenEntity entity = refreshTokenRepository.findByRefreshToken(token);
    if (entity != null) {
        entity.setRevoked(true);
        refreshTokenRepository.save(entity);
    }
}
```

---

## ðŸ”„ ì „ì²´ í”Œë¡œìš°

1. ë¡œê·¸ì¸ â†’ í† í° ë°œê¸‰/ì €ìž¥ (Access, Refresh)
2. API ìš”ì²­ â†’ Access Token ì¸ì¦
3. ë§Œë£Œ ì‹œ â†’ Refresh Tokenìœ¼ë¡œ ìž¬ë°œê¸‰ (DB ê²€ì¦)
4. ê´€ë¦¬ìžê°€ í† í° ì‚­ì œ/ì°¨ë‹¨ â†’ í•´ë‹¹ ì‚¬ìš©ìžëŠ” ì¦‰ì‹œ ë¡œê·¸ì•„ì›ƒ

---

## ðŸ“ í™œìš©/ìš´ì˜ í¬ì¸íŠ¸

- **RefreshToken DB ì €ìž¥ ì‹œì **: ë¡œê·¸ì¸ ì„±ê³µ ì‹œì ì— DBì— ì €ìž¥
- **ë¬´íš¨í™”(ì‚­ì œ/ì°¨ë‹¨) íš¨ê³¼**: ê´€ë¦¬ìžê°€ DBì—ì„œ í† í°ì„ ì‚­ì œ/ì°¨ë‹¨í•˜ë©´, í•´ë‹¹ ì‚¬ìš©ìžëŠ” ìµœëŒ€ 5ë¶„(Access Token ë§Œë£Œ) ì´ë‚´ì— ëª¨ë“  API ìš”ì²­ì´ 401ë¡œ ë°”ë€Œë©° ì¦‰ì‹œ ë¡œê·¸ì•„ì›ƒ íš¨ê³¼ ë°œìƒ
- **ì‹¤ì‹œê°„ ì„¸ì…˜ ì œì–´**: ì—¬ëŸ¬ ê¸°ê¸°/ë¸Œë¼ìš°ì €ë³„ í† í° ê´€ë¦¬ ê°€ëŠ¥, ê´€ë¦¬ìž íŽ˜ì´ì§€ì—ì„œ íŠ¹ì • ìœ ì €ì˜ ì„¸ì…˜ì„ ì§ì ‘ ì œì–´ ê°€ëŠ¥

---

## ðŸ‘¨â€ðŸ’¼ ê´€ë¦¬ìž íŽ˜ì´ì§€ í•„ìš”ì„±

- **íšŒì› ê´€ë¦¬/ì„¸ì…˜ ê´€ë¦¬**: ë¡œê·¸ì¸ ìœ ì € ì •ë³´, ì„¸ì…˜(RefreshToken) ëª©ë¡, ê°•ì œ ë¡œê·¸ì•„ì›ƒ/ì°¨ë‹¨ ê¸°ëŠ¥ ì œê³µ
- **ìš´ì˜/ë³´ì•ˆ**: ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ë° ì œì–´, ë³´ì•ˆ ì‚¬ê³  ëŒ€ì‘ë ¥ ê°•í™”
- **ì¶”ì²œ**: ë³„ë„ì˜ ê´€ë¦¬ìž íŽ˜ì´ì§€ì—ì„œ ìœ ì €/ì„¸ì…˜ ê´€ë¦¬ ê¸°ëŠ¥ êµ¬í˜„ ê¶Œìž¥

---

## ðŸ“ ê²°ë¡ 

- JWT + DB ê¸°ë°˜ RefreshToken ê´€ë¦¬ë¡œ ë³´ì•ˆ, ìš´ì˜, í™•ìž¥ì„± ëª¨ë‘ ìž¡ì„ ìˆ˜ ìžˆìŒ
- íšŒì› ê´€ë¦¬ íŽ˜ì´ì§€ì—ì„œ ì‹¤ì‹œê°„ ì„¸ì…˜ ì œì–´, ê°•ì œ ë¡œê·¸ì•„ì›ƒ ë“± ë‹¤ì–‘í•œ ê¸°ëŠ¥ êµ¬í˜„ ê°€ëŠ¥
- ê´€ë¦¬ìž íŽ˜ì´ì§€ë¥¼ í†µí•´ ì‹¤ë¬´ì  ìš´ì˜/ë³´ì•ˆê¹Œì§€ ì™„ì„± ê°€ëŠ¥
